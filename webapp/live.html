<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>PocketSphinx.js</title>
  </head>
  <body>
    <h2>PocketSphinx.js live demo</h2>
    <ul>
      <li>This demo works on Chrome with the Web Audio API, make sure it works for you and actually records audio (audio recording on Chrome does not work well on all configs).</li>
      <li>Press "Start" and speak digits</li>
    </ul>

    <button id="startBtn">Start</button>
    <button  id="stopBtn">Stop</button>
    <h2>Output</h2>
    <pre id="output"></pre>
    <h2>Error logs</h2>
    <pre id="errors"></pre>

    <script>
      function updateHyp(hyp) {
      output.innerHTML = hyp;
      }
      function addLogs(logs) {
      errors.innerHTML += "\n" + logs;
      }

      var audio_context;
      var recorder;
      var recognizer;

      function startUserMedia(stream) {
      var input = audio_context.createMediaStreamSource(stream);
      input.connect(audio_context.destination);
      recorder = new AudioRecorder(input, recognizer);
      }

      var startRecording = function() {
      recorder && recorder.start();
      }

      var stopRecording = function() {
      recorder && recorder.stop();
      }

      window.onload = function init() {
      recognizer = new PS();
      recognizer.initialize();
      recognizer.addWord("ONE", "W AH N");
      recognizer.addWord("TWO", "T UW");
      recognizer.addWord("THREE", "TH R IY");
      recognizer.addWord("FOUR", "F AO R");
      recognizer.addWord("FIVE", "F AY V");
      recognizer.addWord("SIX", "S IH K S");
      recognizer.addWord("SEVEN", "S EH V AH N");
      recognizer.addWord("EIGHT", "EY T");
      recognizer.addWord("NINE", "N AY N");
      recognizer.addWord("ZERO", "Z IH R OW");
      recognizer.startGrammar(1);
      recognizer.addTransition(0, 0, "ONE");
      recognizer.addTransition(0, 0, "TWO");
      recognizer.addTransition(0, 0, "THREE");
      recognizer.addTransition(0, 0, "FOUR");
      recognizer.addTransition(0, 0, "FIVE");
      recognizer.addTransition(0, 0, "SIX");
      recognizer.addTransition(0, 0, "SEVEN");
      recognizer.addTransition(0, 0, "EIGHT");
      recognizer.addTransition(0, 0, "NINE");
      recognizer.addTransition(0, 0, "ZERO");
      recognizer.endGrammar();

      try {
      window.AudioContext = window.AudioContext || window.webkitAudioContext;
      navigator.getUserMedia = navigator.getUserMedia || navigator.webkitGetUserMedia;
      window.URL = window.URL || window.webkitURL;
      
      audio_context = new AudioContext;
      } catch (e) {
      alert('No web audio support in this browser!');
      }
    
      navigator.getUserMedia({audio: true}, startUserMedia, function(e) {
      addLogs('No live audio input: ' + e);
      });

      document.getElementById('startBtn').onclick = startRecording;
      document.getElementById('stopBtn').onclick = stopRecording;

      };
    </script>
    <script src="js/audioRecorder.js"></script>
    <script src="js/webapp.js"></script>
    <script src="js/pocketsphinx.js"></script>
  </body>
</html>
